name: Notify Versions

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Send Telegram message
        env:
          BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        run: |
          TEXT="Version Update Detected"
          TEXT="$TEXT"$'\n\n'"Morphe:"
          TEXT="$TEXT"$'\n'"YouTube: test"
          TEXT="$TEXT"$'\n'"Music: test"
          TEXT="$TEXT"$'\n'"Reddit: test"
          TEXT="$TEXT"$'\n\n'"Anddea:"
          TEXT="$TEXT"$'\n'"YouTube: test"
          TEXT="$TEXT"$'\n'"Music: test"

          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            --data-urlencode text="${TEXT}"

      - name: Update versions.txt
        run: |
          echo "TEST=1" > versions.txt

      - name: Commit changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add versions.txt

          if git diff --cached --quiet; then
            echo "No changes"
            exit 0
          fi

          git commit -m "chore: update versions"
          git push origin main
